<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de Bitácora #<%= registro.id %></title>
    <link rel="stylesheet" href="/css/styles.css">
    <% if (errorMsg) { %>
    <script>
        // Muestra el mensaje de error del servidor en un alert
        window.onload = function() {
            // Decodifica el mensaje que viene en la URL
            const decodedMsg = decodeURIComponent('<%= errorMsg %>').replace(/ \| /g, '\n');
            alert(decodedMsg);
        };
    </script>
    <% } %>
</head>
<body>
    <h1>Seguimiento de Bitácora #<%= registro.id %></h1>
    
    <form action="/bitacora/update/<%= registro.id %>" method="POST">
        
        <h2>Detalles de la Ronda Original</h2>
        
        <label>Fecha y Hora:</label>
        <input type="text" value="<%= new Date(registro.fecha_hora_ronda).toLocaleString() %>" disabled>
        
        <label>Área/Sector (Max 20):</label>
        <input type="text" value="<%= registro.area_sector %>" disabled>
        
        <label>Punto de Control (Max 20):</label>
        <input type="text" value="<%= registro.punto_control %>" disabled>
        
        <label>Estado Inicial:</label>
        <input type="text" value="<%= registro.estado %>" disabled>
        
        <label>Inspector Original (Max 20):</label>
        <input type="text" value="<%= registro.inspector %>" disabled>
        
        <input type="hidden" name="fecha_hora_ronda" value="<%= new Date(registro.fecha_hora_ronda).toISOString().slice(0, 16) %>">
        <input type="hidden" name="area_sector" value="<%= registro.area_sector %>">
        <input type="hidden" name="punto_control" value="<%= registro.punto_control %>">
        <input type="hidden" name="estado" value="<%= registro.estado %>">
        <input type="hidden" name="inspector" value="<%= registro.inspector %>">


        <h2>Acción y Estado de Seguimiento</h2>

        <label for="observaciones">Observaciones (Revisión y comentarios de seguimiento) (Max 400): </label>
        <textarea id="observaciones" name="observaciones" rows="5" maxlength="400" required><%= registro.observaciones %></textarea>
        
        <label for="seguimiento_requerido">Estado de Seguimiento (Actualizar): </label>
        <select id="seguimiento_requerido" name="seguimiento_requerido" required>
            <option value="No" <%= registro.seguimiento_requerido === 'No' ? 'selected' : '' %>>No Requerido</option>
            <option value="Sí" <%= registro.seguimiento_requerido === 'Sí' ? 'selected' : '' %>>Sí (Pendiente)</option>
            <option value="Completado" <%= registro.seguimiento_requerido === 'Completado' ? 'selected' : '' %>>Completado</option>
        </select>
        
        <div class="button-group">
            <button type="submit">Guardar Seguimiento</button>
            <a href="/bitacora" class="btn-secondary">Cancelar y Regresar</a>
        </div>
    </form>
</body>
</html>